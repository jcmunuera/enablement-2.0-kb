{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "enablement/schemas/trace/generation-trace.schema.json",
  "title": "Generation Trace",
  "description": "Trace of the code generation phase - what was generated in each phase",
  "type": "object",
  "required": ["version", "run_id", "phases", "summary"],
  "properties": {
    "version": {
      "type": "string",
      "const": "1.0",
      "description": "Schema version"
    },
    "run_id": {
      "type": "string",
      "pattern": "^[0-9]{8}_[0-9]{6}$",
      "description": "Run identifier (YYYYMMDD_HHMMSS)"
    },
    "started_at": {
      "type": "string",
      "format": "date-time",
      "description": "Generation start timestamp"
    },
    "completed_at": {
      "type": "string",
      "format": "date-time",
      "description": "Generation completion timestamp"
    },
    "phases": {
      "type": "array",
      "description": "Details of each generation phase",
      "items": {
        "type": "object",
        "required": ["phase", "name", "modules", "files_generated", "compilation_result"],
        "properties": {
          "phase": {
            "type": "integer",
            "minimum": 1,
            "description": "Phase number (1=structural, 2=implementation, 3+=cross-cutting)"
          },
          "name": {
            "type": "string",
            "description": "Phase name (e.g., STRUCTURAL, IMPLEMENTATION, CROSS_CUTTING)"
          },
          "modules": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Module IDs used in this phase"
          },
          "started_at": {
            "type": "string",
            "format": "date-time"
          },
          "completed_at": {
            "type": "string",
            "format": "date-time"
          },
          "files_generated": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Files created in this phase (relative paths)"
          },
          "files_modified": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Files modified in this phase (for phases 2+)"
          },
          "compilation_result": {
            "type": "string",
            "enum": ["PASS", "FAIL", "SKIPPED"],
            "description": "Result of compilation check after this phase"
          },
          "compilation_attempts": {
            "type": "integer",
            "minimum": 1,
            "description": "Number of compilation attempts (if errors were fixed)"
          },
          "errors": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "type": {"type": "string"},
                "message": {"type": "string"},
                "file": {"type": "string"},
                "line": {"type": "integer"},
                "resolved": {"type": "boolean"}
              }
            },
            "description": "Errors encountered during this phase"
          },
          "warnings": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Warnings generated during this phase"
          }
        }
      }
    },
    "tests_generated": {
      "type": "object",
      "description": "Test files generated",
      "properties": {
        "unit_tests": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Unit test files generated"
        },
        "integration_tests": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Integration test files generated"
        }
      }
    },
    "summary": {
      "type": "object",
      "description": "Generation summary statistics",
      "required": ["total_phases", "total_files"],
      "properties": {
        "total_phases": {
          "type": "integer",
          "minimum": 1
        },
        "total_files": {
          "type": "integer",
          "minimum": 0
        },
        "total_lines_of_code": {
          "type": "integer",
          "minimum": 0
        },
        "total_test_files": {
          "type": "integer",
          "minimum": 0
        },
        "total_duration_ms": {
          "type": "integer",
          "minimum": 0,
          "description": "Total generation time in milliseconds"
        },
        "compilation_success": {
          "type": "boolean",
          "description": "Whether final compilation succeeded"
        }
      }
    }
  }
}
