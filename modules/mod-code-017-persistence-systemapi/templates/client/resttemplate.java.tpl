// Template: resttemplate.java.tpl
// Output: {{basePackage}}/adapter/systemapi/client/{{Entity}}SystemApiClient.java
// Purpose: RestTemplate client for System API communication
// Variant: resttemplate

package {{basePackage}}.adapter.systemapi.client;

import {{basePackage}}.adapter.systemapi.dto.{{Entity}}Dto;
import lombok.RequiredArgsConstructor;
import org.slf4j.MDC;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.core.ParameterizedTypeReference;
import org.springframework.http.*;
import org.springframework.stereotype.Component;
import org.springframework.web.client.RestTemplate;

import java.util.List;

/**
 * RestTemplate client for {{Entity}} System API.
 * 
 * Recommended for:
 * - Legacy Spring Boot versions
 * - When imperative style is preferred
 * - Complex request customization
 * 
 * Generated by: mod-017-persistence-systemapi (resttemplate variant)
 * ERI Reference: eri-code-012-persistence-patterns-java-spring
 */
@Component
@RequiredArgsConstructor
public class {{Entity}}SystemApiClient {
    
    private final RestTemplate restTemplate;
    
    @Value("${system-api.{{serviceName}}.base-url}")
    private String baseUrl;
    
    private static final String RESOURCE_PATH = "{{resourcePath}}";
    
    public {{Entity}}Dto getById(String id) {
        String url = baseUrl + RESOURCE_PATH + "/" + id;
        HttpEntity<Void> entity = new HttpEntity<>(createHeaders());
        
        ResponseEntity<{{Entity}}Dto> response = restTemplate.exchange(
            url,
            HttpMethod.GET,
            entity,
            {{Entity}}Dto.class
        );
        
        return response.getBody();
    }
    
    public List<{{Entity}}Dto> getAll() {
        String url = baseUrl + RESOURCE_PATH;
        HttpEntity<Void> entity = new HttpEntity<>(createHeaders());
        
        ResponseEntity<List<{{Entity}}Dto>> response = restTemplate.exchange(
            url,
            HttpMethod.GET,
            entity,
            new ParameterizedTypeReference<>() {}
        );
        
        return response.getBody();
    }
    
    public {{Entity}}Dto save({{Entity}}Dto dto) {
        String url = baseUrl + RESOURCE_PATH;
        HttpEntity<{{Entity}}Dto> entity = new HttpEntity<>(dto, createHeaders());
        
        ResponseEntity<{{Entity}}Dto> response = restTemplate.exchange(
            url,
            HttpMethod.POST,
            entity,
            {{Entity}}Dto.class
        );
        
        return response.getBody();
    }
    
    public void deleteById(String id) {
        String url = baseUrl + RESOURCE_PATH + "/" + id;
        HttpEntity<Void> entity = new HttpEntity<>(createHeaders());
        
        restTemplate.exchange(
            url,
            HttpMethod.DELETE,
            entity,
            Void.class
        );
    }
    
    /**
     * Creates HTTP headers with correlation ID for traceability.
     */
    private HttpHeaders createHeaders() {
        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_JSON);
        
        String correlationId = MDC.get("correlationId");
        if (correlationId != null) {
            headers.set("X-Correlation-ID", correlationId);
        }
        headers.set("X-Source-System", "{{serviceName}}");
        
        return headers;
    }
}
