# Example: Domain API Generation

## Input

```json
{
  "serviceName": "customer-management-api",
  "basePackage": "com.bank.customer",
  "apiLayer": "domain",
  "entities": [
    {
      "name": "Customer",
      "fields": [
        { "name": "firstName", "type": "String", "required": true },
        { "name": "lastName", "type": "String", "required": true },
        { "name": "email", "type": "String", "required": true },
        { "name": "dateOfBirth", "type": "LocalDate" },
        { "name": "status", "type": "CustomerStatus", "required": true }
      ]
    }
  ],
  "features": {
    "resilience": { "enabled": true },
    "persistence": { "type": "system_api" }
  }
}
```

## Expected Module Resolution

Given `apiLayer = domain`:

| Module | Reason |
|--------|--------|
| mod-015-hexagonal-base | Always |
| mod-019-api-public-exposure | Always (pagination + HATEOAS for domain) |
| mod-020-compensation | Domain layer requires compensation |
| mod-001-circuit-breaker | resilience.enabled = true |
| mod-002-retry | resilience.enabled = true |
| mod-003-timeout | resilience.enabled = true |
| mod-017-persistence-systemapi | persistence.type = system_api |
| mod-018-api-integration-rest | persistence.type = system_api |

## Expected Output Structure

```
customer-management-api/
├── pom.xml
├── src/main/java/com/bank/customer/
│   ├── CustomerManagementApiApplication.java
│   ├── domain/
│   │   ├── model/
│   │   │   ├── Customer.java
│   │   │   ├── CustomerId.java
│   │   │   └── CustomerStatus.java
│   │   ├── repository/
│   │   │   └── CustomerRepository.java
│   │   └── transaction/
│   │       ├── Compensable.java
│   │       ├── CompensationRequest.java
│   │       ├── CompensationResult.java
│   │       ├── CompensationStatus.java
│   │       └── TransactionLog.java
│   ├── application/
│   │   ├── service/
│   │   │   └── CustomerApplicationService.java
│   │   └── dto/
│   │       ├── CreateCustomerRequest.java
│   │       ├── UpdateCustomerRequest.java
│   │       └── CustomerResponse.java
│   ├── adapter/
│   │   ├── in/rest/
│   │   │   ├── CustomerController.java
│   │   │   ├── dto/
│   │   │   │   ├── PageResponse.java
│   │   │   │   └── CustomerFilter.java
│   │   │   └── assembler/
│   │   │       └── CustomerModelAssembler.java
│   │   └── out/systemapi/
│   │       └── CustomerSystemApiClient.java
│   └── infrastructure/
│       ├── config/
│       │   ├── ApplicationConfig.java
│       │   └── ResilienceConfig.java
│       ├── web/
│       │   ├── PageableConfig.java
│       │   └── GlobalExceptionHandler.java
│       └── persistence/
│           └── TransactionLogRepository.java
├── src/test/java/com/bank/customer/
│   ├── domain/
│   │   └── model/CustomerTest.java
│   └── adapter/
│       └── in/rest/CustomerControllerTest.java
├── src/main/resources/
│   ├── application.yml
│   └── openapi.yaml
└── .enablement/
    └── manifest.json
```

## Key Generated Files

### CustomerController.java (excerpt)

```java
// =============================================================================
// GENERATED CODE - DO NOT EDIT
// Template: RestController.java.tpl
// Module: mod-code-015-hexagonal-base-java-spring
// Enhanced by: mod-code-019-api-public-exposure-java-spring
// Generated by: skill-021-api-rest-java-spring
// =============================================================================

@RestController
@RequestMapping("/api/v1/customers")
@Tag(name = "Customers", description = "Customer management operations")
public class CustomerController {
    
    private final CustomerApplicationService customerService;
    private final CustomerModelAssembler assembler;
    
    // ... constructor ...
    
    @GetMapping
    public ResponseEntity<PageResponse<CustomerResponse>> list(
            @RequestParam(required = false) String status,
            @RequestParam(required = false) String country,
            @PageableDefault(size = 20) Pageable pageable,
            @RequestHeader(value = "X-Correlation-ID", required = false) String correlationId) {
        
        CustomerFilter filter = new CustomerFilter(status, country);
        Page<Customer> page = customerService.findAll(filter, pageable);
        
        List<CustomerResponse> content = page.getContent().stream()
            .map(assembler::toModel)
            .toList();
        
        Links links = buildPaginationLinks(page, pageable, status, country);
        
        return ResponseEntity.ok(PageResponse.of(
            content,
            page.getNumber(),
            page.getSize(),
            page.getTotalElements(),
            page.getTotalPages(),
            links
        ));
    }
    
    @PostMapping("/compensate")
    public ResponseEntity<CompensationResult> compensate(
            @Valid @RequestBody CompensationRequest request,
            @RequestHeader("X-Correlation-ID") String correlationId) {
        
        CompensationResult result = customerService.compensate(request);
        
        return switch (result.status()) {
            case COMPENSATED, ALREADY_COMPENSATED -> ResponseEntity.ok(result);
            case NOT_FOUND -> ResponseEntity.status(404).body(result);
            case FAILED -> ResponseEntity.status(500).body(result);
            case PENDING -> ResponseEntity.accepted().body(result);
        };
    }
    
    // ... other methods ...
}
```

### CustomerApplicationService.java (excerpt)

```java
// =============================================================================
// GENERATED CODE - DO NOT EDIT
// Template: ApplicationService.java.tpl
// Module: mod-code-015-hexagonal-base-java-spring
// Enhanced by: mod-code-020-compensation-java-spring
// Generated by: skill-021-api-rest-java-spring
// =============================================================================

@Service
public class CustomerApplicationService implements Compensable<CompensationRequest> {
    
    private final CustomerRepository customerRepository;
    private final TransactionLogRepository transactionLogRepository;
    
    // ... constructor ...
    
    @Override
    @Transactional
    public CompensationResult compensate(CompensationRequest request) {
        log.info("Compensation requested for transaction: {}", request.getTransactionId());
        
        Optional<TransactionLog> txLog = transactionLogRepository
            .findByTransactionId(request.getTransactionId());
        
        if (txLog.isEmpty()) {
            return CompensationResult.notFound(
                request.getTransactionId(),
                request.getOriginalOperationId()
            );
        }
        
        if (txLog.get().isCompensated()) {
            return CompensationResult.alreadyCompensated(
                request.getTransactionId(),
                txLog.get().getId()
            );
        }
        
        // Execute compensation logic
        executeCompensation(txLog.get(), request.getReason());
        
        return CompensationResult.compensated(
            request.getTransactionId(),
            txLog.get().getId(),
            "Customer operation compensated successfully"
        );
    }
    
    // ... other methods ...
}
```

## Validation Results

```
=== Tier 1: Universal ===
✅ PASS: Traceability headers present in all files
✅ PASS: Project structure follows hexagonal pattern
✅ PASS: Naming conventions followed

=== Tier 2: Technology ===
✅ PASS: Java compilation successful
✅ PASS: OpenAPI specification valid

=== Tier 3: Module-Specific ===
✅ PASS: PageResponse structure correct (mod-019)
✅ PASS: HATEOAS assembler exists (mod-019)
✅ PASS: Pagination config correct (mod-019)
✅ PASS: Compensable interface implemented (mod-020)
✅ PASS: /compensate endpoint exists (mod-020)
✅ PASS: TransactionLog entity exists (mod-020)

=== Summary ===
Total: 11 checks
Passed: 11
Failed: 0
```
